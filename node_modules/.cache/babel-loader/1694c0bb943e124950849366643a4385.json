{"ast":null,"code":"var _jsxFileName = \"/Users/jubi/fullStack/groupProject/0322/xyz.frontend/src/pages/browse-tasks/browse-tasks-right/task-detail/offer-section/offer-section.js\";\nimport React from \"react\";\nimport { withRouter, Link } from \"react-router-dom\";\nimport ToggleTextbox from \"../../../../../components/toggle-textbox/toggle-textbox\";\nimport JobOffer from \"../../../../../assets/job-offer.svg\";\nimport { get_time_diff } from \"../../../../../utils/time-difference\";\nimport { reqUpdateTask } from \"../../../../../api/api\";\nimport { connect } from \"react-redux\";\nimport { addTaskDetail } from \"../../../../../redux/actions\";\nconst {\n  BASE\n} = global.constants; // TODO @SONIA\n\nclass OfferSection extends React.Component {\n  constructor() {\n    super();\n\n    this.acceptOffer = async offer => {\n      const taskId = this.props.match.params.id;\n\n      try {\n        const result = await reqUpdateTask(taskId, {\n          status: 'assigned',\n          offers: [offer._id]\n        }); //accept offer时改变task.status，并在task.offers里删除除assignee之外的所有offer\n\n        if (result.status === 200) {\n          const {\n            taskDetail\n          } = this.props;\n          taskDetail.offers = [offer];\n          taskDetail.taskData.taskDetail.status = \"assigned\";\n          this.props.addTaskDetail(taskDetail);\n        }\n      } catch (error) {\n        alert(\"failed to request task detail\");\n      }\n    };\n\n    this.pushToGeneratedUrl = (pathname, data) => {\n      if (pathname === 'reply') {\n        this.props.history.push(`${this.props.match.url}/${pathname}-offer-${data.offerId}`);\n      } else {\n        this.props.history.push(`${this.props.match.url}/${pathname}/${this.props.match.params[0]}-${this.props.match.params.id}`);\n      }\n    };\n  }\n\n  render() {\n    const userEmail = this.props.user.email;\n    const {\n      taskData,\n      userRole\n    } = this.props.taskDetail;\n    const {\n      offers\n    } = taskData;\n    const {\n      status\n    } = taskData ? taskData.taskDetail : '';\n    return React.createElement(\"div\", {\n      className: \"task-detail__offer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 50\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"splitter-section-name\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 51\n      },\n      __self: this\n    }, status === 'open' ? 'Offers' : 'Assignee'), offers && offers.length !== 0 ? offers.map(offer => offer.messages.map((message, index) => index === 0 ? React.createElement(\"div\", {\n      className: \"task-detail__offer--offerer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 61\n      },\n      __self: this\n    }, React.createElement(ToggleTextbox, {\n      message: message,\n      offerId: offer._id,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 62\n      },\n      __self: this\n    }), userRole === \"poster\" && React.createElement(React.Fragment, null, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 64\n      },\n      __self: this\n    }, \"$\", offer.price), React.createElement(\"div\", {\n      className: `green-button ${status !== \"open\" && 'button--disabled'} `,\n      onClick: () => {\n        this.acceptOffer(offer);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 67\n      },\n      __self: this\n    }, status === \"open\" ? 'Accept' : 'Accepted'))) : React.createElement(\"div\", {\n      className: \"task-detail__offer--reply\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"avatar-image\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: message.senderInfo.photo && `${BASE}/upload/${message.senderInfo.photo.filename}`,\n      alt: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"poster-detail__item--detail\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"user-name-holder\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: \"\",\n      className: \"user-name\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78\n      },\n      __self: this\n    }, message.senderInfo.username)), message.content, React.createElement(\"div\", {\n      className: \"toggle-textbox__message--bottom\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84\n      },\n      __self: this\n    }, get_time_diff(message.postDate), \" ago\"), userEmail && React.createElement(Link, {\n      onClick: () => this.pushToGeneratedUrl('reply', {\n        offerId: offer._id\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85\n      },\n      __self: this\n    }, \"Reply\")))))) : React.createElement(\"div\", {\n      className: \"task-detail__offer--no-offer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: JobOffer,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"green-button\",\n      onClick: () => {\n        //如果没登陆的话自动跳转登陆\n        if (!userEmail) {\n          this.props.history.push(`${this.props.match.url}/login`);\n        } else if (this.props.user.userRole !== \"poster\") {\n          this.pushToGeneratedUrl('make-an-offer');\n        }\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94\n      },\n      __self: this\n    }, this.props.taskDetail.userRole === \"poster\" ? 'No offer yet' : 'Make an offer', \" \")));\n  }\n\n}\n\nexport default connect(state => ({\n  user: state.user,\n  taskDetail: state.taskDetail\n}), {\n  addTaskDetail\n})(withRouter(OfferSection));","map":{"version":3,"sources":["/Users/jubi/fullStack/groupProject/0322/xyz.frontend/src/pages/browse-tasks/browse-tasks-right/task-detail/offer-section/offer-section.js"],"names":["React","withRouter","Link","ToggleTextbox","get_time_diff","reqUpdateTask","connect","addTaskDetail","BASE","global","constants","OfferSection","Component","constructor","acceptOffer","offer","taskId","props","match","params","id","result","status","offers","_id","taskDetail","taskData","error","alert","pushToGeneratedUrl","pathname","data","history","push","url","offerId","render","userEmail","user","email","userRole","length","map","messages","message","index","price","senderInfo","photo","filename","username","content","postDate","JobOffer","state"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { withRouter, Link } from \"react-router-dom\";\nimport ToggleTextbox from \"../../../../../components/toggle-textbox/toggle-textbox\";\nimport JobOffer from \"../../../../../assets/job-offer.svg\";\nimport { get_time_diff } from \"../../../../../utils/time-difference\";\nimport { reqUpdateTask } from \"../../../../../api/api\";\nimport { connect } from \"react-redux\";\nimport { addTaskDetail } from \"../../../../../redux/actions\"\nconst { BASE } = global.constants;\n// TODO @SONIA\n\nclass OfferSection extends React.Component {\n    constructor() {\n        super();\n    }\n\n    acceptOffer = async (offer) => {\n        const taskId = this.props.match.params.id;\n        try {\n            const result = await reqUpdateTask(taskId, { status: 'assigned', offers: [offer._id] }); //accept offer时改变task.status，并在task.offers里删除除assignee之外的所有offer\n            if (result.status === 200) {\n                const { taskDetail } = this.props;\n                taskDetail.offers = [offer];\n                taskDetail.taskData.taskDetail.status = \"assigned\";\n                this.props.addTaskDetail(taskDetail);\n            }\n        } catch (error) {\n            alert(\"failed to request task detail\");\n        }\n    }\n\n    pushToGeneratedUrl = (pathname, data) => {\n\n        if (pathname === 'reply') {\n            this.props.history.push(`${this.props.match.url}/${pathname}-offer-${data.offerId}`);\n\n        } else {\n            this.props.history.push(\n                `${this.props.match.url}/${pathname}/${this.props.match.params[0]}-${this.props.match.params.id}`\n            );\n        }\n    }\n\n    render() {\n        const userEmail = this.props.user.email;\n        const { taskData, userRole } = this.props.taskDetail;\n        const { offers } = taskData;\n        const { status } = taskData ? taskData.taskDetail : '';\n\n        return (<div className=\"task-detail__offer\">\n            <div className=\"splitter-section-name\">\n                {status === 'open' ? 'Offers' : 'Assignee'}\n            </div>\n            {/* 这里默认如果assign task后，offers里面就只有assignee的offer */}\n            {offers && offers.length !== 0\n                ?\n                offers.map((offer) =>\n                    offer.messages.map((message, index) =>\n                        index === 0\n                            ?\n                            <div className=\"task-detail__offer--offerer\">\n                                <ToggleTextbox message={message} offerId={offer._id} />\n                                {userRole === \"poster\" && <>\n                                    <h3>\n                                        ${offer.price}\n                                    </h3>\n                                    <div className={`green-button ${status !== \"open\" && 'button--disabled'} `} onClick={() => { this.acceptOffer(offer) }}>\n                                        {status === \"open\" ? 'Accept' : 'Accepted'}\n                                    </div></>}\n                            </div>\n                            :\n                            <div className=\"task-detail__offer--reply\">\n                                <div className=\"avatar-image\">\n                                    <img src={message.senderInfo.photo && `${BASE}/upload/${message.senderInfo.photo.filename}`} alt=\"\" />\n                                </div>\n                                <div className=\"poster-detail__item--detail\">\n                                    <div className=\"user-name-holder\">\n                                        <Link to=\"\" className=\"user-name\">\n                                            {message.senderInfo.username}\n                                        </Link>\n                                    </div>\n                                    {message.content}\n\n                                    <div className=\"toggle-textbox__message--bottom\"><span>{get_time_diff(message.postDate)} ago</span>\n                                        {userEmail && <Link onClick={() => this.pushToGeneratedUrl('reply', { offerId: offer._id })}>Reply</Link>}\n                                    </div>\n                                </div>\n                            </div>\n                    )\n                )\n                :\n                <div className=\"task-detail__offer--no-offer\">\n                    <img src={JobOffer} ></img>\n                    <div className=\"green-button\" onClick={() => {\n                        //如果没登陆的话自动跳转登陆\n                        if (!userEmail) {\n                            this.props.history.push(`${this.props.match.url}/login`);\n                        } else if (this.props.user.userRole !== \"poster\") {\n                            this.pushToGeneratedUrl('make-an-offer')\n                        }\n                    }}>{this.props.taskDetail.userRole === \"poster\" ? 'No offer yet' : 'Make an offer'} </div>\n                </div>\n            }\n        </div>\n        );\n    }\n}\nexport default connect(state => ({ user: state.user, taskDetail: state.taskDetail }), { addTaskDetail })(withRouter(OfferSection));"]},"metadata":{},"sourceType":"module"}