{"ast":null,"code":"var _jsxFileName = \"/Users/jubi/fullStack/groupProject/0322/xyz.frontend/src/pages/browse-tasks/browse-tasks-right/task-detail/offer-section/offer-section.js\";\nimport React from \"react\";\nimport { withRouter, Link } from \"react-router-dom\";\nimport ToggleTextbox from \"../../../../../components/toggle-textbox/toggle-textbox\";\nimport JobOffer from \"../../../../../assets/job-offer.svg\";\nimport { get_time_diff } from \"../../../../../utils/time-difference\";\nimport { reqUpdateTask, reqTaskDetail } from \"../../../../../api/api\";\nimport { connect } from \"react-redux\";\nimport { addTaskDetail, reloadTaskList } from \"../../../../../redux/actions\";\nconst {\n  BASE\n} = global.constants; // TODO @SONIA\n\nclass OfferSection extends React.Component {\n  constructor() {\n    super();\n\n    this.acceptOffer = async offer => {\n      const taskId = this.props.match.params.id;\n\n      try {\n        const result = await reqUpdateTask(taskId, {\n          status: 'assigned',\n          offers: [offer._id]\n        }); //accept offer时改变task.status，并在task.offers里删除除assignee之外的所有offer\n\n        const taskDetailResult = await reqTaskDetail(taskId); //accept offer时改变task.status，并在task.offers里删除除assignee之外的所有offer\n\n        this.props.addTaskDetail(taskDetailResult.data);\n\n        if (result.status === 200) {\n          const {\n            taskDetail\n          } = this.props; // taskDetail.offers = [offer];\n\n          taskDetail.taskData.taskDetail.status = \"assigned\"; // this.props.addTaskDetail(taskDetail);\n\n          this.props.reloadTaskList(true);\n        }\n      } catch (error) {\n        alert(\"failed to accept offer\"); ///\n      }\n    };\n\n    this.pushToGeneratedUrl = (pathname, data) => {\n      if (pathname === 'reply') {\n        this.props.history.push(`${this.props.match.url}/${pathname}-offer-${data.offerId}`);\n      } else {\n        this.props.history.push(`${this.props.match.url}/${pathname}/${this.props.match.params[0]}-${this.props.match.params.id}`);\n      }\n    };\n  }\n\n  render() {\n    const userEmail = this.props.user.email;\n    const {\n      taskData,\n      userRole\n    } = this.props.taskDetail;\n    const {\n      offers\n    } = taskData;\n    const {\n      status\n    } = taskData ? taskData.taskDetail : '';\n    return React.createElement(\"div\", {\n      className: \"task-detail__offer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 55\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"splitter-section-name\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 56\n      },\n      __self: this\n    }, status === 'open' ? 'Offers' : 'Assignee'), offers && offers.length !== 0 ? offers.map(offer => offer.messages.map((message, index) => index === 0 ? React.createElement(\"div\", {\n      className: \"task-detail__offer--offerer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 66\n      },\n      __self: this\n    }, React.createElement(ToggleTextbox, {\n      message: message,\n      offerId: offer._id,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 67\n      },\n      __self: this\n    }), userRole === \"poster\" && React.createElement(React.Fragment, null, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 69\n      },\n      __self: this\n    }, \"$\", offer.price), React.createElement(\"div\", {\n      className: `green-button ${status !== \"open\" && 'button--disabled'} `,\n      onClick: () => {\n        this.acceptOffer(offer);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72\n      },\n      __self: this\n    }, status === \"open\" ? 'Accept' : 'Accepted'))) : React.createElement(\"div\", {\n      className: \"task-detail__offer--reply\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"avatar-image\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: message.senderInfo.photo && `${BASE}/upload/${message.senderInfo.photo.filename}`,\n      alt: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"poster-detail__item--detail\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"user-name-holder\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: \"\",\n      className: \"user-name\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83\n      },\n      __self: this\n    }, message.senderInfo.username)), message.content, React.createElement(\"div\", {\n      className: \"toggle-textbox__message--bottom\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }, get_time_diff(message.postDate), \" ago\"), userEmail && React.createElement(Link, {\n      onClick: () => this.pushToGeneratedUrl('reply', {\n        offerId: offer._id\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90\n      },\n      __self: this\n    }, \"Reply\")))))) : React.createElement(\"div\", {\n      className: \"task-detail__offer--no-offer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: JobOffer,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"green-button\",\n      onClick: () => {\n        //如果没登陆的话自动跳转登陆\n        if (!userEmail) {\n          this.props.history.push(`${this.props.match.url}/login`);\n        } else if (this.props.user.userRole !== \"poster\") {\n          this.pushToGeneratedUrl('make-an-offer');\n        }\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99\n      },\n      __self: this\n    }, this.props.taskDetail.userRole === \"poster\" ? 'No offer yet' : 'Make an offer', \" \")));\n  }\n\n}\n\nexport default connect(state => ({\n  user: state.user,\n  taskDetail: state.taskDetail\n}), {\n  addTaskDetail,\n  reloadTaskList\n})(withRouter(OfferSection));","map":{"version":3,"sources":["/Users/jubi/fullStack/groupProject/0322/xyz.frontend/src/pages/browse-tasks/browse-tasks-right/task-detail/offer-section/offer-section.js"],"names":["React","withRouter","Link","ToggleTextbox","get_time_diff","reqUpdateTask","reqTaskDetail","connect","addTaskDetail","reloadTaskList","BASE","global","constants","OfferSection","Component","constructor","acceptOffer","offer","taskId","props","match","params","id","result","status","offers","_id","taskDetailResult","data","taskDetail","taskData","error","alert","pushToGeneratedUrl","pathname","history","push","url","offerId","render","userEmail","user","email","userRole","length","map","messages","message","index","price","senderInfo","photo","filename","username","content","postDate","JobOffer","state"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { withRouter, Link } from \"react-router-dom\";\nimport ToggleTextbox from \"../../../../../components/toggle-textbox/toggle-textbox\";\nimport JobOffer from \"../../../../../assets/job-offer.svg\";\nimport { get_time_diff } from \"../../../../../utils/time-difference\";\nimport { reqUpdateTask, reqTaskDetail } from \"../../../../../api/api\";\nimport { connect } from \"react-redux\";\nimport { addTaskDetail, reloadTaskList } from \"../../../../../redux/actions\"\nconst { BASE } = global.constants;\n// TODO @SONIA\n\nclass OfferSection extends React.Component {\n    constructor() {\n        super();\n    }\n\n    acceptOffer = async (offer) => {\n        const taskId = this.props.match.params.id;\n        try {\n            const result = await reqUpdateTask(taskId, { status: 'assigned', offers: [offer._id] }); //accept offer时改变task.status，并在task.offers里删除除assignee之外的所有offer\n            const taskDetailResult = await reqTaskDetail(taskId); //accept offer时改变task.status，并在task.offers里删除除assignee之外的所有offer\n\n            this.props.addTaskDetail(taskDetailResult.data)\n\n            if (result.status === 200) {\n                const { taskDetail } = this.props;\n                // taskDetail.offers = [offer];\n                taskDetail.taskData.taskDetail.status = \"assigned\";\n                // this.props.addTaskDetail(taskDetail);\n                this.props.reloadTaskList(true);\n            }\n        } catch (error) {\n            alert(\"failed to accept offer\");///\n        }\n    }\n\n    pushToGeneratedUrl = (pathname, data) => {\n\n        if (pathname === 'reply') {\n            this.props.history.push(`${this.props.match.url}/${pathname}-offer-${data.offerId}`);\n\n        } else {\n            this.props.history.push(\n                `${this.props.match.url}/${pathname}/${this.props.match.params[0]}-${this.props.match.params.id}`\n            );\n        }\n    }\n\n    render() {\n        const userEmail = this.props.user.email;\n        const { taskData, userRole } = this.props.taskDetail;\n        const { offers } = taskData;\n        const { status } = taskData ? taskData.taskDetail : '';\n\n        return (<div className=\"task-detail__offer\">\n            <div className=\"splitter-section-name\">\n                {status === 'open' ? 'Offers' : 'Assignee'}\n            </div>\n            {/* 这里默认如果assign task后，offers里面就只有assignee的offer */}\n            {offers && offers.length !== 0\n                ?\n                offers.map((offer) =>\n                    offer.messages.map((message, index) =>\n                        index === 0\n                            ?\n                            <div className=\"task-detail__offer--offerer\">\n                                <ToggleTextbox message={message} offerId={offer._id} />\n                                {userRole === \"poster\" && <>\n                                    <h3>\n                                        ${offer.price}\n                                    </h3>\n                                    <div className={`green-button ${status !== \"open\" && 'button--disabled'} `} onClick={() => { this.acceptOffer(offer) }}>\n                                        {status === \"open\" ? 'Accept' : 'Accepted'}\n                                    </div></>}\n                            </div>\n                            :\n                            <div className=\"task-detail__offer--reply\">\n                                <div className=\"avatar-image\">\n                                    <img src={message.senderInfo.photo && `${BASE}/upload/${message.senderInfo.photo.filename}`} alt=\"\" />\n                                </div>\n                                <div className=\"poster-detail__item--detail\">\n                                    <div className=\"user-name-holder\">\n                                        <Link to=\"\" className=\"user-name\">\n                                            {message.senderInfo.username}\n                                        </Link>\n                                    </div>\n                                    {message.content}\n\n                                    <div className=\"toggle-textbox__message--bottom\"><span>{get_time_diff(message.postDate)} ago</span>\n                                        {userEmail && <Link onClick={() => this.pushToGeneratedUrl('reply', { offerId: offer._id })}>Reply</Link>}\n                                    </div>\n                                </div>\n                            </div>\n                    )\n                )\n                :\n                <div className=\"task-detail__offer--no-offer\">\n                    <img src={JobOffer} ></img>\n                    <div className=\"green-button\" onClick={() => {\n                        //如果没登陆的话自动跳转登陆\n                        if (!userEmail) {\n                            this.props.history.push(`${this.props.match.url}/login`);\n                        } else if (this.props.user.userRole !== \"poster\") {\n                            this.pushToGeneratedUrl('make-an-offer')\n                        }\n                    }}>{this.props.taskDetail.userRole === \"poster\" ? 'No offer yet' : 'Make an offer'} </div>\n                </div>\n            }\n        </div>\n        );\n    }\n}\nexport default connect(state => ({ user: state.user, taskDetail: state.taskDetail }), { addTaskDetail, reloadTaskList })(withRouter(OfferSection));"]},"metadata":{},"sourceType":"module"}